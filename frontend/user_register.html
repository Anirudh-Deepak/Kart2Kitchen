<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Register/Login</title>
<style>
body { font-family: Arial, sans-serif; background:#f2f2f2; padding:20px; }
.container { background:#fff; padding:30px; border-radius:10px; max-width:400px; margin:auto; box-shadow:0 5px 15px rgba(0,0,0,0.2);}
h2 { margin-bottom:15px; color:#333; }
input { width:100%; padding:12px; margin:10px 0; border:1px solid #ccc; border-radius:5px; }
button { width:100%; padding:12px; margin-top:10px; border:none; border-radius:5px; background:#007bff; color:#fff; cursor:pointer; font-size:16px; }
button:hover { background:#0056b3; }
</style>
</head>
<body>
<div class="container">
    <h2>User Registration</h2>
    <form id="userRegisterForm">
        <input type="text" id="name" placeholder="Name" required>
        <!-- Restrict phone input -->
        <input type="text" id="phone" placeholder="Phone" maxlength="10" pattern="\d{10}" 
               oninput="this.value=this.value.replace(/[^0-9]/g,'');" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Register</button>
    </form>
</div>

<div class="container" style="margin-top:30px;">
    <h2>User Login</h2>
    <form id="userLoginForm">
        <!-- Restrict login phone input -->
        <input type="text" id="loginPhone" placeholder="Phone" maxlength="10" pattern="\d{10}" 
               oninput="this.value=this.value.replace(/[^0-9]/g,'');" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button type="submit">Login</button>
    </form>
</div>

<script>
document.getElementById('userRegisterForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const password = document.getElementById('password').value.trim();

    if(phone.length !== 10){
        alert("Phone number must be exactly 10 digits");
        return;
    }

    try {
        const res = await fetch('http://localhost:5000/user_register', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify({ name, phone, password })
        });
        const data = await res.json();
        alert(data.message || data.error);
    } catch(err) { alert('Server error'); }
});

document.getElementById('userLoginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const phone = document.getElementById('loginPhone').value.trim();
    const password = document.getElementById('loginPassword').value.trim();

    if(phone.length !== 10){
        alert("Phone number must be exactly 10 digits");
        return;
    }

    try {
        const res = await fetch('http://localhost:5000/user_login', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify({ phone, password })
        });
        const data = await res.json();
        if(res.ok && data.user){
            localStorage.setItem('session', JSON.stringify({
                role: 'user',
                name: data.user.name,
                phone: data.user.phone,
                vendors: data.vendors
            }));
            window.location.href = 'user_dashboard.html';
        } else alert(data.error || 'Login failed');
    } catch(err) { alert('Server error'); }
});
</script>
</body>
</html>
