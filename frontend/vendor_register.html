<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vendor Register/Login</title>
<style>
body { font-family: Arial, sans-serif; background:#f2f2f2; padding:20px; }
.container { background:#fff; padding:30px; border-radius:10px; max-width:400px; margin:auto; box-shadow:0 5px 15px rgba(0,0,0,0.2);}
h2 { margin-bottom:15px; color:#333; }
input { width:100%; padding:12px; margin:10px 0; border:1px solid #ccc; border-radius:5px; }
button { width:100%; padding:12px; margin-top:10px; border:none; border-radius:5px; background:#28a745; color:#fff; cursor:pointer; font-size:16px; }
button:hover { background:#218838; }
</style>
</head>
<body>
<div class="container">
    <h2>Vendor Registration</h2>
    <form id="vendorRegisterForm">
        <input type="text" id="name" placeholder="Name" required>
        <input type="text" id="phone" placeholder="Phone" maxlength="10" pattern="\d{10}"
               oninput="this.value=this.value.replace(/[^0-9]/g,'');" required>
        <input type="password" id="password" placeholder="Password" required>
        <input type="text" id="locality" placeholder="Locality" required>
        <input type="text" id="service" placeholder="Service (e.g. Vegetables, Fruits)" required>
        <button type="submit">Register</button>
    </form>
</div>

<div class="container" style="margin-top:30px;">
    <h2>Vendor Login</h2>
    <form id="vendorLoginForm">
        <input type="text" id="loginPhone" placeholder="Phone" maxlength="10" pattern="\d{10}"
               oninput="this.value=this.value.replace(/[^0-9]/g,'');" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button type="submit">Login</button>
    </form>
</div>

<script>
document.getElementById('vendorRegisterForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const password = document.getElementById('password').value.trim();
    const locality = document.getElementById('locality').value.trim();
    const service = document.getElementById('service').value.trim();

    if(phone.length !== 10){
        alert("Phone number must be exactly 10 digits");
        return;
    }

    try {
        const res = await fetch('http://localhost:5000/vendor_register', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify({ name, phone, password, locality, service })
        });
        const data = await res.json();
        if(res.ok){
            alert(`${data.message}\nScanner Code: ${data.scannerCode}`);
        } else {
            alert(data.error || 'Registration failed');
        }
    } catch(err) {
        alert('Server error: ' + err.message);
    }
});

document.getElementById('vendorLoginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const phone = document.getElementById('loginPhone').value.trim();
    const password = document.getElementById('loginPassword').value.trim();

    if(phone.length !== 10){
        alert("Phone number must be exactly 10 digits");
        return;
    }

    try {
        const res = await fetch('http://localhost:5000/vendor_login', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify({ phone, password })
        });
        const data = await res.json();
        if(res.ok && data.vendor){
            localStorage.setItem('session', JSON.stringify({
                role: 'vendor',
                name: data.vendor.name,
                phone: data.vendor.phone,
                locality: data.vendor.locality,
                service: data.vendor.service,
                scannerCode: data.vendor.scannerCode
            }));
            window.location.href = 'vendor_dashboard.html';
        } else {
            alert(data.error || 'Login failed');
        }
    } catch(err) {
        alert('Server error: ' + err.message);
    }
});
</script>
</body>
</html>
