<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vendor Login</title>
<style>
body { font-family: Arial; background:#f2f2f2; padding:20px;}
.container { background:#fff; padding:20px; border-radius:8px; max-width:400px; margin:auto; box-shadow:0 4px 12px rgba(0,0,0,0.2);}
input, button { width:100%; padding:10px; margin-top:10px; border-radius:5px; border:1px solid #ccc;}
button { background:#28a745; color:#fff; border:none; cursor:pointer;}
button:hover { background:#218838; }
</style>
</head>
<body>
<div class="container">
  <h2>Vendor Login</h2>
  <form id="vendorLoginForm" onsubmit="return false;">
      <input type="text" id="phone" placeholder="Phone" required>
      <input type="password" id="password" placeholder="Password" required>
      <button type="submit">Login</button>
  </form>
</div>

<script>
document.getElementById('vendorLoginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    e.stopPropagation();

    const phone = document.getElementById('phone').value.trim();
    const password = document.getElementById('password').value.trim();

    try {
        const res = await fetch('http://localhost:5000/vendor_login', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify({ phone, password })
        });

        const data = await res.json();
        console.log("Login response:", data);

        if(res.ok && data.vendor){
            // Save session
            const session = {
                role: 'vendor',
                name: data.vendor.name,
                phone: data.vendor.phone,
                locality: data.vendor.locality
            };
            localStorage.setItem('session', JSON.stringify(session));
            setTimeout(() => {
                window.location.replace('vendor_dashboard.html');
            }, 200);
        } else {
            alert(data.error || 'Login failed');
        }
    } catch(err){
        console.error(err);
        alert('Server error');
    }
});
</script>
</body>
</html>
